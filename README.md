# scradio
Онлайн-радиостанция с автоматическим диджеем и веб-сайтом
## Зависимости
- Python 3.10 или новее
- FFmpeg
- opus-tools
- Python библиотеки (см. `requirements.txt`)
## Структура для развёртывания
- Стример (`main.py`)
- Веб-приложение (`app.py`, не обязательно для работы стримера)
- База данных PostgreSQL
- Медиасервер Icecast
## Инструкция по развёртыванию
### Подготовка
Перед развертыванием проверьте, что все необходимые зависимости установлены. В Debian/Ubuntu их можно установить следующей командой:
```sh
sudo apt install python3 python3-pip ffmpeg opus-tools
```
Для установки Python библиотек выполните:
```sh
pip install -r requirements.txt
```
Для запуска нужно будет записать настройки в конфигурационный файл `config.py`. Рекомендуется взять `config.py.example` как основу:
```sh
mv config.py.example config.py # переименовать config.py.example в config.py
```
### Настройка базы данных
Для работы SCRadio нужна база данных PostgreSQL.
Рекомендую создать отдельного пользователя и базу данных для него:
```sql
CREATE USER scradio WITH PASSWORD '53c1237';
CREATE DATABASE scradio OWNER scradio;
```
Запишите настройки для подключения к БД в конфигурационный файл, затем выполните скрипт `init_db.py`. Структура базы данных будет настроена автоматически.
### Настройка Icecast
Нужно будет настроить маунты Icecast для вещания:
- `/scradio`, формат MP3, битрейт 256 Кбит/с
- `/scradio.opus`, формат Opus, битрейт 128 Кбит/с
Не забудьте внести настройки для подключения к Icecast в конфиг.
### Настройка путей
Создайте папку для медиафайлов и пропишите её в конфиг. В ней будут храниться песни и обложки.
**Важно.** Если вы используете сторонний HTTP сервер, настройте его так, чтобы медиапапка была доступна из веба по адресу `/static/media/`.
### Подготовка плейлиста
Чтобы добавить песни, используйте интерактивный скрипт `vsrconv.py`:
```sh
python3 vsrconv.py /path/to/song.mp3
```
**Важно.** SCRadio использует "умный" плейлист, который упорядочивает песни так, чтобы одна и та же песня не включалась слишком часто. Если в плейлисте мало песен (20 и менее), стример может не запуститься.
Чтобы сделать новые песни видимыми для стримера, запустите скрипт проверки медиа:
```sh
python3 vsr_check_media.py
```
### Запуск
Для запуска стримера выполните `main.py`, для запуска веб-интерфейса - `app.py`.
## Рекомендации
Для использования в продакшене лучше настроить отдельный веб-сервер (Gunicorn или nginx+uwsgi).
Также следует использовать сложные пароли.
